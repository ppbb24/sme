# Smart Eye — 装机调试 & ODS 项目交接文档

> 本文档是从 Claude.ai 对话中提取的完整设计决策和上下文，供 Claude Code 继续开发使用。

---

## 一、项目概述

**Smart Eye** 是一套工业视觉检测软件，包含两大功能模块：

| 模块 | 用户 | 目的 |
|------|------|------|
| **装机调试** | 调试工程师 | 从零创建标准配方，确保相机成像质量达标 |
| **ODS（现场调试系统）** | 现场工程师/运维 | 以标准配方为基准，校准现场设备至一致状态 |

两者共享底层能力（取图、四步检测、参数调整），但面向不同用户、不同场景、不同保存策略。装机调试的产出物（标准配方）是 ODS 的输入物。

---

## 二、文件清单

| 文件 | 说明 |
|------|------|
| `Smart Eye 装机调试与ODS交互Demo.jsx` | **最新版完整 Demo**（React JSX），包含工作台首页 + 装机调试四步 + ODS四步，所有状态反馈 |
| `装机调试-交互Demo.jsx` | 早期版本，仅包含装机调试部分（可忽略，以最新版为准） |
| `Smart Eye 装机调试与ODS功能规格说明书.docx` | 完整的功能规格 Word 文档，四章：概述、装机调试、ODS、通用交互规范 |
| `2_1_工作台-首页.png` | UI 视觉参考图 — 工作台首页 |
| `2_2_装机调试-位姿.png` | UI 视觉参考图 — 装机调试位置与姿态步骤 |

---

## 三、装机调试 — 完整设计决策

### 3.1 四步流程

严格按顺序执行（前面步骤的产出影响后续步骤）：

**第一步：位置与姿态**
- 目的：工件在视野中居中，位姿正确
- 自动操作：「自动寻找中心并锁定」
- 状态：待调试 → 执行中（对位中...）→ 对位成功 ✓ / 对位失败 ✗
- 核心指标：对位状态、X/Y偏移量（像素）
- 可调参数：光源亮度(1/2/3)、曝光、增益、Gamma、允许误差X/Y、图像中心、视野ROI中心
- 图像叠加：绿色十字线（图像中心）、蓝色虚线框（视野ROI）

**第二步：清晰度**
- 目的：图像清晰，对焦准确
- 自动操作：「自动对焦」
- 状态：待调试 → 执行中（对焦中...）→ PASS / FAIL
- 核心指标：清晰度评分（数值，越高越好）、判定结果
- 可调参数：对焦模式(自动/手动)、清晰度阈值、对焦精度、对焦速度(低/中/高)
- 图像叠加：蓝色框「自动对焦ROI」

**第三步：亮度**
- 目的：前景/背景亮度差异合理，对比度充足
- 自动操作：「自动亮度优化」
- 状态：待调试 → 执行中（优化中...）→ 优化成功 / 优化失败
- 核心指标：前景亮度(FROI均值)、背景亮度(BROI均值)、差异值
- 可调参数：亮度、曝光、增益、Gamma
- ROI管理：支持添加/删除ROI对，每对含FROI+BROI，可拖拽调整
- 图像叠加：左上角实时显示ROI亮度值和差异值

**第四步：色度**
- 目的：白平衡正确，颜色还原准确
- 自动操作：「自动色度优化」
- 核心指标：白平衡偏差/色温值
- 可调参数：R/G/B通道白平衡比率值
- ROI共享：与亮度步骤共用同一套ROI对，显示「当前使用亮度步骤中的ROI对 | 前往调整ROI」

### 3.2 一键自动调试

1. 点击右上角「一键自动调试」→ 弹出确认弹窗
2. 确认后按钮变为「调试中...」，禁用所有操作按钮
3. 依次执行四步，自动切换tab，右侧面板显示进度
4. 完成后弹出结果总览（四步✓/✗状态一览）
5. 中途某步失败 → 停留在失败步骤，提示手动调整

### 3.3 取图与ROI策略

- 进入页面自动取一帧图
- 可点「重新取图」刷新
- ROI是系统在第一步识别工件后自动生成的，不是用户前置任务
- 用户不满意可手动拖拽调整

### 3.4 保存流程

- 四步完成后弹出结果总览
- 即使有步骤未通过也允许保存
- 两种保存方式：覆盖原配方 / 另存为新配方
- 保存时自动保存参考图供ODS使用
- 离开时未完成 → 弹窗「调试尚未完成，是否保存当前进度？」

### 3.5 界面布局

- 顶部栏：Smart Eye logo + 导航（相机管理、工作台、点位配方管理）
- 次顶部：面包屑 + 四步Tab + 一键自动调试按钮
- 左侧：图像预览区（主区域，含叠加标注）
- 右侧面板（~330px）：核心指标 + 自动按钮 + 可调参数 + ROI管理
- 底部：取图 | 重置 | 下一步（最后一步为「完成」）

### 3.6 参数面板设计原则

- 不要有高级参数折叠，全部展示
- 自动模式下参数是「只读结果展示」，手动模式下是「可编辑控件」
- 每步都有核心指标让用户一眼知道效果
- 参数实时预览：拖滑块时图像立即响应

---

## 四、ODS — 完整设计决策

### 4.1 核心区别

| 维度 | 装机调试 | ODS |
|------|----------|-----|
| 操作起点 | 空白/已有配方 | 标准配方 + 当前设备取图 |
| 核心动作 | 调参使成像达标 | 比对标准、修正偏差 |
| 界面 | 单图 + 参数面板 | 双图对比 + 偏差指标 + 参数面板 |
| 保存目标 | 标准配方 | 样机配方（标准配方只读） |
| 判定标准 | 绝对值达标 | 与标准的偏差在可接受范围 |
| 自动调整目标 | 让图像质量达标 | 让成像效果与标准一致 |

### 4.2 操作流程

1. 进入ODS，选择点位 → 系统自动取图显示
2. 从配方库选择标准配方 → 右侧加载标准参考图
3. 双图并排后点击「一键评价」
4. 系统跑四步检测，输出偏差结果（PASS/FAIL + 偏差数据）
5. 用户点进FAIL步骤，可「自动调整」或手动微调
6. 调完后单步重新评价确认
7. 全部调整完毕 → 保存到样机配方

### 4.3 四步详解

**第一步：成像视野确定**
- 目的：靶标特征移到视野正中心，与标准配方一致
- 核心指标：靶标中心偏移X/Y（标准值 vs 当前值 vs 偏差）
- 可调参数：光源亮度(1/2/3)、曝光、增益、Gamma
- FAIL标红：偏移超标 → 标红偏移值，提示物理调整
- 图像叠加：标准图绿色十字线，当前图PASS绿色/FAIL红色十字线

**第二步：清晰度调整**
- 核心指标：清晰度评分对比
- 可调参数：对焦模式(自动/手动)、清晰度阈值、对焦精度、对焦速度
- FAIL标红：清晰度不足 → 标红评分 + 对焦参数

**第三步：亮度**
- 核心指标：前景亮度FROI、背景亮度BROI、差异值
- 可调参数：亮度、曝光、增益、Gamma、ROI管理
- FAIL标红：哪个指标超标就标红哪个 + 相关滑块

**第四步：相机白平衡调整（两个子环节）**
- 子环节A：灰度一致性校验 — 各ROI灰度值对比
- 子环节B：白平衡调整 — R/G/B通道比率对比
- 可调参数：白平衡模式(自动/手动)、R/G/B通道比率、亮度
- 面板布局：上下两个区块，各自有PASS/FAIL

### 4.4 标红交互

- **指标标红**：偏差超标的指标行，背景浅红色，偏差值红色字
- **参数标红**：相关参数滑块轨道变红 / 旁边出现红色提示点
- **自动调整按钮**：FAIL时更醒目样式

### 4.5 ODS界面布局

- 顶部：点位选择器 + 标准配方选择 + 一键评价按钮
- 四步Tab：各Tab带PASS/FAIL状态图标
- 图像区：左=标准配方参考图（只读+锁标识），右=当前设备实拍图
- 偏差指标区：标准值 vs 当前值 vs 偏差 vs 状态
- 参数面板：自动调整按钮 + 滑块（带标准值绿色参考线）
- 底部：上一点位 | 标记通过 | 保存到样机配方 | 下一点位

### 4.6 偏差区分

- **效果偏差**（清晰度差了3分）= 结果量，是判定PASS/FAIL的依据
- **参数偏差**（曝光差了5）= 过程量，帮助用户理解原因

---

## 五、通用交互规范

1. **参数实时预览**：滑块拖动时图像立即响应
2. **步骤跳转**：可点击任意Tab跳转，但建议按顺序
3. **标准配方保护**（ODS）：全程只读，锁图标，不提供编辑入口
4. **ROI管理**：亮度和色度共享同一套ROI对，管理入口在亮度步骤
5. **ROI视觉规范**：FROI蓝色边框、BROI绿色边框、选中四角拖拽手柄
6. **配方参考图**：装机调试保存时自动保存，供ODS使用
7. **点位切换**（ODS）：底部前后翻页，不退出比对界面

---

## 六、视觉风格

- 浅色主题（#D9D9D9 背景）
- 顶部菜单栏背景为深色（#1E1E1E）
- 主色调：#8bc34a（Smart Eye品牌绿）
- 状态色：绿色=通过、红色=失败、蓝色=信息/ROI
- 图标库：Lucide Icons
- 字体：PingFang SC / Microsoft YaHei / Noto Sans SC
- 工作台首页为浅灰背景 + 白色卡片（参考 2_1_工作台-首页.png）

---

## 七、待确认 / 后续事项

- [ ] 标准配方保存时是否同时保存参考图（目前设计为是）
- [ ] 样机配方存储结构：完整独立配方 vs 差异化存储
- [ ] 配方库选择界面细节：下拉 vs 卡片，缩略图和搜索
- [ ] ODS双图布局：当前为左右并排，是否需要支持上下叠放
- [ ] 相机实时画面流的接入方式
- [ ] ROI的坐标数据结构和持久化方案
